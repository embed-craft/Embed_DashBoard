import React, { useState } from 'react';import React, { useState } from 'react';

import { Plus, Edit2, Trash2, Copy } from 'lucide-react';import { Plus, Edit2, Trash2, Copy } from 'lucide-react';

import PageHeader from '../components/layout/PageHeader';import PageHeader from '../components/layout/PageHeader';

import PageContainer from '../components/layout/PageContainer';import PageContainer from '../components/layout/PageContainer';

import DataTable, { Column } from '../components/shared/DataTable';import DataTable, { Column } from '../components/shared/DataTable';

import Button from '../components/shared/Button';import Button from '../components/shared/Button';

import StatusBadge, { StatusType } from '../components/shared/StatusBadge';import StatusBadge, { StatusType } from '../components/shared/StatusBadge';

import IconButton from '../components/shared/IconButton';import IconButton from '../components/shared/IconButton';

import SearchInput from '../components/shared/SearchInput';import SearchInput from '../components/shared/SearchInput';

import { useStore } from '../store/useStore';import { useStore } from '../store/useStore';

import { theme } from '../styles/design-tokens';import { theme } from '../styles/design-tokens';

import { toast } from 'sonner';import { toast } from 'sonner';

import { useNavigate } from 'react-router-dom';import { useNavigate } from 'react-router-dom';



interface CampaignRow {interface CampaignRow {

  id: string;  id: string;

  name: string;  name: string;

  status: 'active' | 'draft' | 'paused';  status: 'active' | 'draft' | 'paused';

  targeting: string;  targeting: string;

  createdAt: string;  createdAt: string;

  impressions: number;  impressions: number;

  clicks: number;  clicks: number;

}}



/**/**

 * Campaigns Page - Lists all campaigns with actions * Campaigns Page - Lists all campaigns with actions

 * Matches screenshot: table with search, filters, status badges, action buttons * Matches screenshot: table with search, filters, status badges, action buttons

 */ */

const Campaigns: React.FC = () => {const Campaigns: React.FC = () => {

  const { campaigns, deleteCampaign, addCampaign } = useStore();  const { campaigns, deleteCampaign, addCampaign } = useStore();

  const navigate = useNavigate();  const navigate = useNavigate();

  const [searchQuery, setSearchQuery] = useState('');  const [searchQuery, setSearchQuery] = useState('');



  // Transform store campaigns to table format  // Transform store campaigns to table format

  const tableData: CampaignRow[] = campaigns.map((campaign) => ({  const tableData: CampaignRow[] = campaigns.map((campaign) => ({

    id: campaign.id,    id: campaign.id,

    name: campaign.name,    name: campaign.name,

    status: campaign.status,    status: campaign.status,

    targeting: campaign.rules && campaign.rules.length > 0    targeting: campaign.rules && campaign.rules.length > 0

      ? `${campaign.rules.length} rule${campaign.rules.length > 1 ? 's' : ''}`      ? `${campaign.rules.length} rule${campaign.rules.length > 1 ? 's' : ''}`

      : 'All users',      : 'All users',

    createdAt: new Date(campaign.createdAt).toLocaleDateString('en-US', {    createdAt: new Date(campaign.createdAt).toLocaleDateString('en-US', {

      month: 'short',      month: 'short',

      day: 'numeric',      day: 'numeric',

      year: 'numeric',      year: 'numeric',

    }),    }),

    impressions: campaign.impressions,    impressions: campaign.impressions,

    clicks: campaign.clicks,    clicks: campaign.clicks,

  }));  }));



  // Filter campaigns by search  // Filter campaigns by search

  const filteredData = tableData.filter((campaign) =>  const filteredData = tableData.filter((campaign) =>

    campaign.name.toLowerCase().includes(searchQuery.toLowerCase())    campaign.name.toLowerCase().includes(searchQuery.toLowerCase())

  );  );



  const handleEdit = (id: string) => {  const handleEdit = (id: string) => {

    navigate(`/campaign-builder?id=${id}`);    navigate(`/campaign-builder?id=${id}`);

  };  };



  const handleDuplicate = (id: string) => {  const handleDuplicate = (id: string) => {

    const campaign = campaigns.find(c => c.id === id);    const campaign = campaigns.find(c => c.id === id);

    if (campaign) {    if (campaign) {

      addCampaign({      addCampaign({

        ...campaign,        ...campaign,

        name: `${campaign.name} (Copy)`,        name: `${campaign.name} (Copy)`,

        status: 'draft',        status: 'draft',

        impressions: 0,        impressions: 0,

        clicks: 0,        clicks: 0,

        conversions: 0,        conversions: 0,

        conversion: '0%',        conversion: '0%',

      });      });

      toast.success('Campaign duplicated successfully');      toast.success('Campaign duplicated successfully');

    }    }

  };  };



  const handleDelete = (id: string) => {  const handleDelete = (id: string) => {

    if (confirm('Are you sure you want to delete this campaign?')) {    if (confirm('Are you sure you want to delete this campaign?')) {

      deleteCampaign(id);      deleteCampaign(id);

      toast.success('Campaign deleted');      toast.success('Campaign deleted');

    }    }

  };  };



  // Table columns configuration  // Table columns configuration

  const columns: Column<CampaignRow>[] = [  const columns: Column<CampaignRow>[] = [

    {    {

      key: 'name',      key: 'name',

      header: 'Campaign Name',      header: 'Campaign Name',

      sortable: true,      sortable: true,

      width: '25%',      width: '25%',

      render: (row) => (      render: (row) => (

        <div>        <div>

          <p          <p

            style={{            style={{

              margin: 0,              margin: 0,

              fontWeight: theme.typography.fontWeight.medium,              fontWeight: theme.typography.fontWeight.medium,

              color: theme.colors.text.primary,              color: theme.colors.text.primary,

            }}            }}

          >          >

            {row.name}            {row.name}

          </p>          </p>

        </div>        </div>

      ),      ),

    },    },

    {    {

      key: 'status',      key: 'status',

      header: 'Status',      header: 'Status',

      sortable: true,      sortable: true,

      width: '12%',      width: '12%',

      render: (row) => <StatusBadge status={row.status as StatusType} />,      render: (row) => <StatusBadge status={row.status as StatusType} />,

    },    },

    {    {

      key: 'targeting',      key: 'targeting',

      header: 'Targeting',      header: 'Targeting',

      width: '18%',      width: '18%',

      render: (row) => (      render: (row) => (

        <span style={{ color: theme.colors.text.secondary }}>        <span style={{ color: theme.colors.text.secondary }}>

          {row.targeting}          {row.targeting}

        </span>        </span>

      ),      ),

    },    },

    {    {

      key: 'impressions',      key: 'impressions',

      header: 'Impressions',      header: 'Impressions',

      sortable: true,      sortable: true,

      width: '12%',      width: '12%',

      align: 'right',      align: 'right',

      render: (row) => (      render: (row) => (

        <span style={{ fontWeight: theme.typography.fontWeight.medium }}>        <span style={{ fontWeight: theme.typography.fontWeight.medium }}>

          {row.impressions?.toLocaleString()}          {row.impressions?.toLocaleString()}

        </span>        </span>

      ),      ),

    },    },

    {    {

      key: 'clicks',      key: 'clicks',

      header: 'Clicks',      header: 'Clicks',

      sortable: true,      sortable: true,

      width: '12%',      width: '12%',

      align: 'right',      align: 'right',

      render: (row) => (      render: (row) => (

        <span style={{ fontWeight: theme.typography.fontWeight.medium }}>        <span style={{ fontWeight: theme.typography.fontWeight.medium }}>

          {row.clicks?.toLocaleString()}          {row.clicks?.toLocaleString()}

        </span>        </span>

      ),      ),

    },    },

    {    {

      key: 'createdAt',      key: 'createdAt',

      header: 'Created',      header: 'Created',

      sortable: true,      sortable: true,

      width: '13%',      width: '13%',

      render: (row) => (      render: (row) => (

        <span style={{ color: theme.colors.text.secondary }}>        <span style={{ color: theme.colors.text.secondary }}>

          {row.createdAt}          {row.createdAt}

        </span>        </span>

      ),      ),

    },    },

    {    {

      key: 'actions',      key: 'actions',

      header: 'Actions',      header: 'Actions',

      width: '8%',      width: '8%',

      align: 'right',      align: 'right',

      render: (row) => (      render: (row) => (

        <div style={{ display: 'flex', gap: theme.spacing[1], justifyContent: 'flex-end' }}>        <div style={{ display: 'flex', gap: theme.spacing[1], justifyContent: 'flex-end' }}>

          <IconButton          <IconButton

            icon={<Edit2 size={16} />}            icon={<Edit2 size={16} />}

            variant="default"            variant="default"

            size="sm"            size="sm"

            title="Edit campaign"            title="Edit campaign"

            onClick={(e) => {            onClick={(e) => {

              e.stopPropagation();              e.stopPropagation();

              handleEdit(row.id);              handleEdit(row.id);

            }}            }}

          />          />

          <IconButton          <IconButton

            icon={<Copy size={16} />}            icon={<Copy size={16} />}

            variant="default"            variant="default"

            size="sm"            size="sm"

            title="Duplicate campaign"            title="Duplicate campaign"

            onClick={(e) => {            onClick={(e) => {

              e.stopPropagation();              e.stopPropagation();

              handleDuplicate(row.id);              handleDuplicate(row.id);

            }}            }}

          />          />

          <IconButton          <IconButton

            icon={<Trash2 size={16} />}            icon={<Trash2 size={16} />}

            variant="danger"            variant="danger"

            size="sm"            size="sm"

            title="Delete campaign"            title="Delete campaign"

            onClick={(e) => {            onClick={(e) => {

              e.stopPropagation();              e.stopPropagation();

              handleDelete(row.id);              handleDelete(row.id);

            }}            }}

          />          />

        </div>        </div>

      ),      ),

    },    },

  ];  ];



  const handleRowClick = (campaign: CampaignRow) => {  const handleRowClick = (campaign: CampaignRow) => {

    handleEdit(campaign.id);    handleEdit(campaign.id);

  };  };



  return (  return (

    <>    <>

      <PageHeader      <PageHeader

        title="Campaigns"        title="Campaigns"

        subtitle={`${filteredData.length} total campaign${filteredData.length !== 1 ? 's' : ''}`}        subtitle={`${filteredData.length} total campaign${filteredData.length !== 1 ? 's' : ''}`}

        actions={        actions={

          <Button          <Button

            variant="primary"            variant="primary"

            size="md"            size="md"

            icon={<Plus size={18} />}            icon={<Plus size={18} />}

            onClick={() => navigate('/campaign-builder')}            onClick={() => navigate('/campaign-builder')}

          >          >

            Create Campaign            Create Campaign

          </Button>          </Button>

        }        }

      />      />



      <PageContainer>      <PageContainer>

        {/* Filters Bar */}        {/* Filters Bar */}

        <div        <div

          style={{          style={{

            display: 'flex',            display: 'flex',

            alignItems: 'center',            alignItems: 'center',

            gap: theme.spacing[4],            gap: theme.spacing[4],

            marginBottom: theme.spacing[6],            marginBottom: theme.spacing[6],

          }}          }}

        >        >

          <SearchInput          <SearchInput

            placeholder="Search campaigns..."            placeholder="Search campaigns..."

            value={searchQuery}            value={searchQuery}

            onChange={(e) => setSearchQuery(e.target.value)}            onChange={(e) => setSearchQuery(e.target.value)}

            style={{ flex: 1, maxWidth: '400px' }}            style={{ flex: 1, maxWidth: '400px' }}

          />          />

        </div>        </div>



        {/* Data Table */}        {/* Data Table */}

        <DataTable        <DataTable

          columns={columns}          columns={columns}

          data={filteredData}          data={filteredData}

          keyExtractor={(row) => row.id}          keyExtractor={(row) => row.id}

          onRowClick={handleRowClick}          onRowClick={handleRowClick}

          pagination={{          pagination={{

            enabled: true,            enabled: true,

            pageSize: 10,            pageSize: 10,

          }}          }}

          emptyMessage={          emptyMessage={

            searchQuery            searchQuery

              ? 'No campaigns found matching your search'              ? 'No campaigns found matching your search'

              : 'No campaigns yet. Create your first campaign to get started!'              : 'No campaigns yet. Create your first campaign to get started!'

          }          }

        />        />

      </PageContainer>      </PageContainer>

    </>    </>

  );  );

};};



export default Campaigns;export default Campaigns;



  const handleRowClick = (campaign: CampaignRow) => {
    handleEdit(campaign.id);
  };

  return (
    <>
      <PageHeader
        title="Campaigns"
        subtitle={`${filteredData.length} total campaign${filteredData.length !== 1 ? 's' : ''}`}
        actions={
          <Button
            variant="primary"
            size="md"
            icon={<Plus size={18} />}
            onClick={() => navigate('/campaign-builder')}
          >
            Create Campaign
          </Button>
        }
      />

      <PageContainer>
        {/* Filters Bar */}
        <div
          style={{
            display: 'flex',
            alignItems: 'center',
            gap: theme.spacing[4],
            marginBottom: theme.spacing[6],
          }}
        >
          <SearchInput
            placeholder="Search campaigns..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            style={{ flex: 1, maxWidth: '400px' }}
          />
        </div>

        {/* Data Table */}
        <DataTable
          columns={columns}
          data={filteredData}
          keyExtractor={(row) => row.id}
          onRowClick={handleRowClick}
          pagination={{
            enabled: true,
            pageSize: 10,
          }}
          emptyMessage={
            searchQuery
              ? 'No campaigns found matching your search'
              : 'No campaigns yet. Create your first campaign to get started!'
          }
        />
      </PageContainer>
    </>
  );
};

export default Campaigns;
        {/* Header */}
        <div className="flex items-center justify-between animate-fade-in">
          <div>
            <h1 className="text-4xl font-bold">Campaigns</h1>
            <p className="text-muted-foreground mt-2">
              Manage your in-app nudges â€¢ {campaigns.length} total
            </p>
          </div>
          <Link to="/campaigns/new">
            <Button className="bg-gradient-primary hover:shadow-glow transition-all hover-scale">
              <Plus className="mr-2 h-4 w-4" />
              New Campaign
            </Button>
          </Link>
        </div>

        {/* Campaigns List */}
        <div className="space-y-4">
          {campaigns.length === 0 ? (
            <Card className="p-12 text-center border-border/50">
              <p className="text-muted-foreground mb-4">No campaigns yet</p>
              <Link to="/campaigns/new">
                <Button className="bg-gradient-primary">
                  <Plus className="mr-2 h-4 w-4" />
                  Create Your First Campaign
                </Button>
              </Link>
            </Card>
          ) : (
            campaigns.map((campaign, index) => (
              <Card 
                key={campaign.id} 
                className="p-6 border-border/50 hover:shadow-lg transition-all animate-fade-in"
                style={{ animationDelay: `${index * 0.1}s` }}
              >
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-3">
                      <h3 className="text-xl font-semibold">{campaign.name}</h3>
                      <Badge
                        variant={campaign.status === "active" ? "default" : campaign.status === "paused" ? "secondary" : "outline"}
                        className={campaign.status === "active" ? "bg-accent animate-pulse" : ""}
                      >
                        {campaign.status === "active" ? (
                          <Play className="h-3 w-3 mr-1" />
                        ) : (
                          <Pause className="h-3 w-3 mr-1" />
                        )}
                        {campaign.status}
                      </Badge>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                      <div>
                        <p className="text-sm text-muted-foreground">Trigger Event</p>
                        <p className="font-mono text-sm mt-1">{campaign.trigger}</p>
                      </div>
                      <div>
                        <p className="text-sm text-muted-foreground">Target Segment</p>
                        <p className="text-sm mt-1">{campaign.segment}</p>
                      </div>
                    </div>

                    <div className="flex gap-6">
                      <div>
                        <p className="text-sm text-muted-foreground">Impressions</p>
                        <p className="text-lg font-semibold">{campaign.impressions.toLocaleString()}</p>
                      </div>
                      <div>
                        <p className="text-sm text-muted-foreground">Clicks</p>
                        <p className="text-lg font-semibold">{campaign.clicks.toLocaleString()}</p>
                      </div>
                      <div>
                        <p className="text-sm text-muted-foreground">Conversions</p>
                        <p className="text-lg font-semibold">{campaign.conversions.toLocaleString()}</p>
                      </div>
                      <div>
                        <p className="text-sm text-muted-foreground">CVR</p>
                        <p className="text-lg font-semibold text-accent">{campaign.conversion}</p>
                      </div>
                    </div>
                  </div>

                  <div className="flex flex-col gap-3 ml-6">
                    <div className="flex items-center gap-2">
                      <span className="text-sm text-muted-foreground">Active</span>
                      <Switch
                        checked={campaign.status === "active"}
                        onCheckedChange={() => handleToggle(campaign.id)}
                      />
                    </div>
                    <Link to={`/campaigns/${campaign.id}`}>
                      <Button variant="outline" size="sm" className="w-full hover-scale">
                        <BarChart3 className="h-4 w-4 mr-2" />
                        View
                      </Button>
                    </Link>
                    <Button 
                      variant="outline" 
                      size="sm" 
                      className="w-full hover-scale"
                      onClick={() => handleClone(campaign)}
                    >
                      <Copy className="h-4 w-4 mr-2" />
                      Clone
                    </Button>
                    <AlertDialog>
                      <AlertDialogTrigger asChild>
                        <Button variant="outline" size="sm" className="w-full text-destructive hover-scale">
                          <Trash2 className="h-4 w-4 mr-2" />
                          Delete
                        </Button>
                      </AlertDialogTrigger>
                      <AlertDialogContent>
                        <AlertDialogHeader>
                          <AlertDialogTitle>Delete Campaign?</AlertDialogTitle>
                          <AlertDialogDescription>
                            This will permanently delete "{campaign.name}". This action cannot be undone.
                          </AlertDialogDescription>
                        </AlertDialogHeader>
                        <AlertDialogFooter>
                          <AlertDialogCancel>Cancel</AlertDialogCancel>
                          <AlertDialogAction
                            onClick={() => handleDelete(campaign.id)}
                            className="bg-destructive text-destructive-foreground hover:bg-destructive/90"
                          >
                            Delete
                          </AlertDialogAction>
                        </AlertDialogFooter>
                      </AlertDialogContent>
                    </AlertDialog>
                  </div>
                </div>
              </Card>
            ))
          )}
        </div>
      </div>
    </div>
  );
};

export default Campaigns;
